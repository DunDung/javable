---
layout: post
title: React Ref는 왜 이렇게 생겼을까?
author: [파노]
tags: ['react', 'ref']
date: '2021-05-15T12:00:00.000Z'
draft: false
image: ../teaser/react-ref.png
---

### 0. Intro

React로 웹프론트엔드 개발을 하다보면 React만으로는 DOM을 조작하기 어려울 때가 있습니다.
가장 흔하게는 어떤 엘리먼트를 focus해야할 때 말이죠. 리액트에서 Ref 속성은 무엇이고, 왜 사용하는지, 언제 사용하는지와 ref에 대해 드는 궁금증에 대해 이야기해보는 시간을 가져보려고 합니다.

### 1. Ref가 뭘까?

![reference의 정의 - 네이버 영어 사전](https://images.velog.io/images/fan/post/ba2c2401-6a86-403f-890c-caeca7b528b1/image.png)

Ref는 Reference의 준말입니다. 한국말로는 참고, 참조 정도가 React의 Ref의 의미를 잘 나타냅니다.

> **_ Ref는 render 메서드에서 생성된 DOM 노드나 React 엘리먼트에 접근하는 방법을 제공합니다. - 리액트 공식문서 中 _**

Ref는 DOM에 직접적인 접근을 가능케해줍니다.

```js
class Example extends React.Component {
  constructor(props) {
    super(props);
    this.ref = React.createRef();
  }

  componentDidMount() {
    console.log(this.ref.current.style.backgroundColor);
  }

  render() {
    return (
      <div ref={this.ref} style={{ backgroundColor: 'red', width: '100px', height: '100px' }} />
    );
  }
}
```

위와 같이 createRef(혹은 useRef)함수를 통해 ref를 생성하면, ref객체를 React Element의 ref prop에 전달합니다. 그러면 함수가 반환한 객체의 current 프로퍼티로 해당 React Element의 DOM에 접근을 할 수 있게됩니다.

콘솔에는 다음과 같은 결과가 나옵니다.

![](https://images.velog.io/images/fan/post/d0bc7d0b-f063-41a1-8977-070cd5c9341a/image.png)

ref는 언제 활용할 수 있을까요? 공식문서에서는 아래와 같이 정의합니다.

    - js로 DOM 요소에 focus하기, 텍스트 선택영역, 혹은 미디어의 재생을 관리할 때.
    - 애니메이션을 직접적으로 실행시킬 때.
    - 서드 파티 DOM 라이브러리를 React와 같이 사용할 때.

언제, 왜 사용하는지는 알 수 있는 것 같습니다. 하지만 DOM API가 있는데 왜 굳이 써야되고, 또 왜 이런 형태일까요?

### 1. 왜 current로 접근해야하나?

querySelector처럼 그냥 DOM요소를 반환해주면 좋을텐데, 왜 createRef/useRef는 왜 객체를 반환하고 current 프로퍼티로 DOM요소를 전달해줄까요? 이는 리액트가 가상돔을 기반으로 작동하는 라이브러리라는 사실을 생각해보면 이유가 명확해집니다.

공식문서는 이렇게 설명합니다.

> 컴포넌트가 마운트될 때 React는 current 프로퍼티에 DOM 엘리먼트를 대입하고, 컴포넌트의 마운트가 해제될 때 current 프로퍼티를 다시 null로 돌려 놓습니다. ref를 수정하는 작업은 componentDidMount 또는 componentDidUpdate 생명주기 메서드가 호출되기 전에 이루어집니다.

실제 DOM에 React노드가 렌더될 때까지 ref가 가리키는 DOM요소의 주소값은 확정된 것이 아닙니다.

즉 우리가 ref에 접근할 수 있는 시점은 React노드가 실제로 DOM에 반영되는 시점부터인 것입니다. (라이프사이클 상에서는 componentDidMount) 그 이전에는 null이 current프로퍼티에 담깁니다. (useRef는 초기값을 따로 인자로 전달해줄 수 있습니다.)
그리고 가상DOM이 변경될 때 실제DOM의 요소도 변경되는 경우가 있기 때문에 DOM이 업데이트되는 경우(componentDidUpdate)도 Ref의 Current값이 변경되게 됩니다. 이처럼 유동적이기에 리액트는 객체를 반환해 current프로퍼티의 값을 계속해서 수정합니다.

### 2. 왜 DOM API를 쓰면 안될까?

또 궁금증이 생깁니다. 그냥 DOM API로 요소에 접근하면 안될까?
DOM API는 리액트에서 동작하지 않을까요? 동작합니다.
위 예제를 바꿔보겠습니다.

```js
class Example extends React.Component {
  constructor(props) {
    super(props);
    this.ref = React.createRef();
  }

  componentDidMount() {
    console.log('querySelector!: ', document.querySelector('#hi').style.backgroundColor);
  }

  render() {
    return <div id="hi" style={{ backgroundColor: 'red', width: '100px', height: '100px' }} />;
  }
}
```

결과는 아래와 같습니다.
![](https://images.velog.io/images/fan/post/f051993a-7293-4b64-9c95-c7237ae38c94/image.png)

잘 작동합니다. 그러면 왜 되도록 ref를 써야하는 걸까요?

ref는 특정 DOM 요소를 가져올 때 더 신뢰할만하기 때문입니다.
1번 내용처럼 라이프사이클에 따라 DOM요소를 가져오지 못하는 경우가 있습니다. 예측하지 못한 상황(대개는 라이프사이클의 흐름을 예측하지 못한 상황)으로 DOM요소를 가져오지 못한다면 이는 해당 코드가 포함된 로직에 따라 큰 결함으로 이어질 수 있을 것입니다. 또 만약 컴포넌트가 하나가 아닌 여러 개가 생성되는 경우를 생각해봅시다. 이때 우리는 id나 class로 특정해서 원하는 DOM요소를 가져올 수 있을까요? 분명 쉽지 않을 것입니다. DOM요소를 특정할 수 있도록 관심영역을 특정 컴포넌트로 제한하는 역할도 Ref가 할 수 있습니다.

#### reference

- https://ko.reactjs.org/docs/refs-and-the-dom.html
- https://stackoverflow.com/questions/59198952/using-document-queryselector-in-react-should-i-use-refs-instead-how
